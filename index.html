<!DOCTYPE html>
<html lang="ar">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/bootstrap-rtl.min.css" />
    <link rel="stylesheet" href="assets/style.css" />

    <title>تهنئة العيد</title>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-12">
          <canvas id="canvas"></canvas>
        </div>

        <div class="col-12 main-cont mb-5 pt-3">
          <p>
            لإنشاء بطاقة التهنئة الخاصة بك بمناسبة العيد و إرسالها لأحبائك،
            الرجاء تعبئة الاسم في المكان المخصص أدناه:
          </p>

          <form class="form-inline mt-2">
            <label for="name">أدخل الاسم:</label>
            <input
              maxlength="30"
              type="text"
              class="form-control mb-2 mr-sm-2"
              id="name"
              placeholder=""
            />
            <a href="#" class="btn btn-primary mb-2" style="
            background-color: #007A61;"">تحميل الصورة</a>
            <div class="name-place invisible"></div>
          </form>
        </div>

        <div class="row"></div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="assets/jquery-3.2.1.slim.min.js"></script>
    <script type="text/javascript">
      $(function () {
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        var imgEle = new Image();
        imgEle.src = "https://lh3.googleusercontent.com/pw/AP1GczM3arq_-Y60EtX0JdOZq3zBLEC-STYAVQIX9rRaD_K2r8Pyg6bIb8kST5Lod6U099OD8LjAyN6OKBt6PoGc8eJcKZGoViI48KLHZfxNPgHi3oeZ8c24ZUzQ9EYsdTD2uSJtbMqDluGKXbyFFp5JVLauqeh814YDTiRNwYORfUcw79894E1JAbeEenEKOCdv95ZiHi2k3q5CglbmFVhg8P_SVd3H6ilrnn4eg1Qs_9NRf3ecng09Ql8-PZzDSn7-28OPSXzBdxw-OpllStFy-SJbl-nCPSySxVuxZCdSIekRGGloneMH69cGurgJ_EE4BQGLUmtFvspUnGc-MOBJL3-6RKgw9AuExcGDkYLluRT7-4S5n3NIuFHI2QMxC9txMe9GJ3TkWghWd2hNTkR_O-vMc2AT_Q1N9Xzk6oP7zu0IFejeS20XRJeI_mmXg8WQfM3GA9gs6emhINgnVvuQqQd1LOWiMVe2R1DM3a7TCI-KT0nGQ67K1pOhdtSry-DkEorpGcybDFvuQqwb09udv4O9kl_KbKCv-jWYWoDly0NKexVFv9M-WifC8lk23eomB9teU6pl_HbTHsVf6SUvmHlwp5H1Kmkeevn8Vy-Qk-1vgMdiCNA8ibCKUhjYjdGETdA92ldoYTLnT8JHRpALowkVNwz_S3xPGzHMrVAGm3f9l39Mhy1G9vGdudI7HFV7HG16NvvculLlFTPauxM8AQCQ9gTbrrx1TC5bQX6fGRJh_JL00xq7c_6x09U93VIVPOhdXNMydCqo17GF1wv-IaPAczh07W-AcLSI2-IzIb1C3wHITCc7owoDWrXUXu1Lb9mlmM-xJeURPkJCdvJcEG9wSGr-zZKmVkhO2lKBTw1Zm9cSsUax4QGUIj2klxAJ0vgBdLyRWjodjWSmiZlnOFb06w=w1045-h923-s-no-gm?authuser=0";

        imgEle.onload = function () {
          canvas.width = imgEle.width;
          canvas.height = imgEle.height;

          ctx.drawImage(imgEle, 0, 0);
          ctx.font = "30pt The-Sans";
        };

        $(document).on("input", "#name", function () {
          //redraw image
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(imgEle, 0, 0);

          var name = $(this).val();
          ctx.fillStyle = "#FFFFFF";
          ctx.textAlign = "ٌRTL";

          ctx.fillText(name, canvas.width * 0.96, canvas.height * 0.7);

          /*
              var nameArr = name.split(' ');
      
              var nNameArr = [''];
              for (var i=0; i<nameArr.length; i++) {
                  var tPrx = nNameArr[0] + nameArr[i];
                  if (tPrx.length <= 30)
                      nNameArr[0] += ' '+ nameArr[i];
                  else
                      nNameArr[1] += ' '+ nameArr[i]; 
              }
          	
              for (var i=0; i<nNameArr.length; i++) {
                  if (i >= 2) return;
      
                  $('.name-place').html(nNameArr[i]);
      	
      	
                   var textWidth = ctx.measureText(nNameArr[i] ).width
      
                  //refill text
                  var textX = 400 + textWidth; //textWidth + ( (parseInt(canvas.width) - parseInt(textWidth) ) / 2 ) ;
                  var textY =  parseInt(canvas.height) - 47;//parseInt(canvas.height/2) + 90
                  
      
                  ctx.fillStyle = "#007599";
              	
              	
      
                        ctx.fillText(nNameArr[i], textX, textY + (i*60));
              }
              */

          return false;
        });

        $(".btn-primary").click(function () {
          if ($("#name").val().trim() == "") return false;

          var dataUrl = document
            .getElementById("canvas")
            .toDataURL("image/jpeg", 1);

          var image = new Image();
          image.src = dataUrl;

          var w = window.open("");
          w.document.write(image.outerHTML);

          //$(this).attr('href', document.getElementById('canvas').toDataURL('image/jpeg', 0.5));
          //$(this).attr('download', 'Eid-Greeting.jpg');

          $("#name").val("");
          $("#name").trigger("input");
        });
      });
    </script>
  </body>
</html>
